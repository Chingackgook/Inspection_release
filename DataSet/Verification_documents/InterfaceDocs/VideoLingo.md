# API Documentation

## Function: `ask_gpt`

### Description
The `ask_gpt` function is designed to interact with the GPT model to generate responses based on a given prompt. It supports caching of responses to optimize performance and reduce redundant API calls. The function can also validate the response format based on a provided validation definition.

### Parameters
- **`prompt`** (str): 
  - **Description**: The input text or question that you want the GPT model to respond to.
  - **Value Range**: Any string input.
  
- **`resp_type`** (str, optional): 
  - **Description**: Specifies the expected format of the response. If set to "json", the function will attempt to parse the response as a JSON object.
  - **Value Range**: `None` or `"json"`.
  
- **`valid_def`** (callable, optional): 
  - **Description**: A validation function that checks the validity of the response. It should return a dictionary with a 'status' key indicating success or failure, and a 'message' key for error details.
  - **Value Range**: A callable function that takes a response object and returns a dictionary.
  
- **`log_title`** (str, optional): 
  - **Description**: A title used for logging the request and response in the cache. This helps in organizing logs based on different contexts or use cases.
  - **Value Range**: Any string input (default is "default").

### Return Value
- **Returns**: 
  - The function returns the response generated by the GPT model based on the provided prompt.
  - If `resp_type` is "json", it returns a parsed JSON object; otherwise, it returns a plain string.

### Purpose
The `ask_gpt` function serves as an interface to communicate with the GPT model, allowing users to obtain responses to their queries while leveraging caching for efficiency. It also provides an option to validate the response format, ensuring that the output meets expected criteria.

### Example Usage
```python
result = ask_gpt("What is the capital of France?", resp_type="json")
print(result)  # Expected output: {"code": 200, "message": "success"}
```

### Error Handling
- Raises a `ValueError` if the API key is not set.
- Raises a `ValueError` if the response validation fails, including the error message from the validation function.
- Retries the request up to 5 times in case of failure, as specified by the `@except_handler` decorator.